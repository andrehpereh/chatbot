{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_DATA_PREP:$TAG_NAME",
        "."
      ],
      "dir": "./components/data_preparation"
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_DATA_PREP:$TAG_NAME"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_FINE_TUNE:$TAG_NAME",
        "--build-arg",
        "KAGGLE_KEY=$_KAGGLE_KEY",
        "--build-arg",
        "KAGGLE_USERNAME=$_KAGGLE_USERNAME",
        "."
      ],
      "dir": "./components/fine_tunning"
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_FINE_TUNE:$TAG_NAME"
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "build",
        "-t",
        "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_PIPELINE:$TAG_NAME",
        "."
      ],
      "dir": "./components/pipeline"
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "args": [
        "push",
        "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_PIPELINE:$TAG_NAME"
      ]
    },
    {
      "name": "gcr.io/$PROJECT_ID/$_CONTAINER_IMAGE_NAME_PIPELINE:$TAG_NAME",
      "dir": "./components/pipeline",
      "args": [
        "python",
        "pipeline.py"
      ],
      "env": [
        "BUCKET_NAME=$_BUCKET_NAME",
        "BUCKET_URI=$_BUCKET_URI"
      ]
    }
  ]
}